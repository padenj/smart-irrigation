name: Build and Release with Semantic Versioning

on:
  push:
    tags:
      - 'v*.*.*' # Trigger only on semantic version tags (e.g., v1.2.3)

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 16 # Change to your Node.js version

    - name: Install dependencies
      run: npm ci

    - name: Build application
      run: npm run build

    - name: Extract version from tag
      run: echo "${GITHUB_REF##*/}" > version.txt

    - name: Include version in build
      run: cp version.txt ./build/

    - name: Create release package
      run: zip -r release-package.zip . -x '*.git*' 'node_modules/*'

    - name: Upload to GitHub Release
      uses: ncipollo/release-action@v1
      with:
        artifacts: release-package.zip
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
